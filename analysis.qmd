---
title: "Discrimination"
author: "David Kane"
format: html
execute: 
  echo: false
  message: false
---

```{r}
#| label: setup
suppressPackageStartupMessages({
  library(gt)
  library(tidyverse)
  library(brms)
  library(tidybayes)
  library(bayesplot)
})

x <- read_csv('data/resume.csv', show_col_types = FALSE)

```

```{r}
model <- brm(formula = call ~ race,
         data = x,
         family = bernoulli(),
         refresh = 0,
         silent = 2,
         seed = 9)
model
```

```{r}
#|cache: true
# Generate predictions
preds <- model |>
  add_epred_draws(newdata = tibble(race = c("white", "black"))) |>
  select(race, .epred)

# Plot the results
plot <- ggplot(preds, aes(x = .epred, fill = race)) +
  geom_histogram(binwidth = 0.001, alpha = 0.8, position = "identity") +
  scale_fill_manual(values = c("black" = "red", "white" = "cyan")) +
  scale_x_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(
    title = "Posterior for Callback Rates",
    subtitle = "Resumes with white-coded names are much more likely to receive callbacks",
    x = "Probability of Callback",
    fill = "(Likely) Race of Name on Resume"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 20, face = "bold"),
    plot.subtitle = element_text(size = 14),
    legend.title = element_text(size = 14),
    legend.text = element_text(size = 12),
    axis.title.x = element_text(size = 14),
    axis.text.y = element_blank(), # Remove y-axis labels
    axis.title.y = element_blank()  # Remove y-axis title
  )

plot
```

## From Monday's Class

### Background Information

Bertrand, Marianne and Sendhil Mullainathan. 2004. "Are Emily and Greg More Employable Than Lakisha and Jamal? A Field Experiment on Labor Market Discrimination." American Economic Review, 94 (4): 991â€“1013. Data cleaned and discussed in "Quantitative Social Science: An Introduction" by Kosuke Imai.

"We study race in the labor market by sending fictitious resumes to help-wanted ads in Boston and Chicago newspapers. To manipulate perceived race, resumes are randomly assigned African-American- or White-sounding names. White names receive 50 percent more callbacks for interviews. Callbacks are also more respon- sive to resume quality for White names than for African-American ones. The racial gap is uniform across occupation, industry, and employer size. We also find little evidence that employers are inferring social class from the names. Differential treatment by race still appears to still be prominent in the U.S. labor market."

### Discussion

Subject: Discrimination

Broad question: Race and employment in the United States

Specific question: Effect of racially-coded names on call-backs in 2020's for adults in Boston and Chicago applying for jobs.

Preceptor Table: 
  
  * Units: individuals (or resumes ?) 
  
  * (Potential) Outcomes: call-back if black name, call-back if white name   
  
  * Causal/predictive: a causal model  
  
  * Covariates: sex, zip code (not shown in table)  
  
  * Treatment: black name on resume versus white name on resume 

## Example Preceptor Table
  
```{r}
tibble(ID = c("1", "2", "...", "10", "11", "...", "N"),
       attitude_after_control = c("Yes*", "No", "...", "No*", "Yes*", "...", "Yes"),
       attitude_after_treated = c("Yes", "Yes*", "...", "No", "Yes", "...", "No*"),
       treatment = c("Black", "White", "...", "Black", "Black", "...", "White")) |>
  
  gt() |>
  tab_header(title = "Preceptor Table") |> 
  cols_label(ID = md("ID"),
             attitude_after_control = md("Callback if White Name"),
             attitude_after_treated = md("Callback if Black Name"),
             treatment = md("Treatment")) |>
  tab_style(cell_borders(sides = "right"),
            location = cells_body(columns = c(ID))) |>
  tab_style(style = cell_text(align = "left", v_align = "middle", size = "large"), 
            locations = cells_column_labels(columns = c(ID))) |>
  cols_align(align = "center", columns = everything()) |>
  cols_align(align = "left", columns = c(ID)) |>
  fmt_markdown(columns = everything()) |>
  tab_spanner(label = "Potential Outcomes", columns = c(attitude_after_control, attitude_after_treated)) |>
  tab_spanner(label = "Covariate", columns = c(treatment))
```

## Questions for Second Class

<!-- There are no "right" answers. Each person/group might have a different goal . . . -->

> What are the units, precisely?

All the people sending out resumes for entry-level positions in Boston and Chicago during 2020 -- 2030 who have names which are associated with a race. So, N is (?) in the thousands.

> What is the moment in time, precisely?

2020 to 2030

> What is one reason why validity might not hold?

There is less of a strong connection between names and race.

> Describe the Population Table in words

Every time a person with a racially-coded name sends out a resume in Boston/Chicago between 2000 and 2030.

> What is one reason why stability might not hold?



> What is one reason why representativeness might not hold?



> What is one reason why unconfoundedness might not hold?



> Describe in words what the Preceptor Table would look like if we were trying to, instead, predict whether or not someone would get a callback?


```{r}
tibble(ID = c("1", "2", "...", "10", "11", "...", "N"),
       attitude_after_control = c("Yes", "No", "...", "No", "Yes", "...", "Yes"),
       treatment = c("Black", "White", "...", "Black", "Black", "...", "White")) |>
  
  gt() |>
  tab_header(title = "Preceptor Table") |> 
  cols_label(ID = md("ID"),
             attitude_after_control = md("Callback"),
             treatment = md("Treatment")) |>
  tab_style(cell_borders(sides = "right"),
            location = cells_body(columns = c(ID))) |>
  tab_style(style = cell_text(align = "left", v_align = "middle", size = "large"), 
            locations = cells_column_labels(columns = c(ID))) |>
  cols_align(align = "center", columns = everything()) |>
  cols_align(align = "left", columns = c(ID)) |>
  fmt_markdown(columns = everything()) |>
  tab_spanner(label = "Outcome", columns = c(attitude_after_control)) |>
  tab_spanner(label = "Covariate", columns = c(treatment))
```



  